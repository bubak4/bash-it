#!/bin/bash
# Time-stamp: <2024-08-16 11:28:49 martin>

JIDEA_HOME=$HOME/.local/opt/jetbrains/idea-IU

# we do not want anything else (even Java) in the PATH
PATH=/usr/local/bin:/usr/bin:/bin
export PATH

#
# java virtual machine of choice
#

. ~/bin/env-jdk-temurin-21.sh
vm="$JAVA_HOME/bin/java"
echo "I: vm=${vm}"

#
# memory
#

max_jvm_memory=12g
echo "I: max_jvm_memory=${max_jvm_memory}"

#
# executing command
#

user=$(id -un)-$(id -u)
export IDEA_VM_OPTIONS=/tmp/${user}_idea_ultimate.vmoptions

cat > $IDEA_VM_OPTIONS <<EOF
-XX:ReservedCodeCacheSize=512m
-XX:+UseCodeCacheFlushing
-XX:-UseLargePages
-ea
-Xms${max_jvm_memory}
-Xmx${max_jvm_memory}
-Dsun.io.useCanonCaches=false
-Djava.net.preferIPv4Stack=true
-Djava.library.path=/usr/lib/jni:/usr/lib/x86_64-linux-gnu/jni
-Duser.name=martin.slouf
-Dswing.aatext=true
-Dawt.useSystemAAFontSettings=lcd
-Dsun.java2d.uiScale.enabled=false
EOF

cat $IDEA_VM_OPTIONS

$JIDEA_HOME/bin/idea "$@"
